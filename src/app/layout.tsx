import type { Metadata } from 'next'
import './globals.css'
import AuthProvider from "@/utils/authProvider";
import Header from "@/components/header/header";
import Footer from "@/components/footer/footer";
import "@fortawesome/fontawesome-svg-core/styles.css";
import { config } from "@fortawesome/fontawesome-svg-core";
import {getServerSession} from "next-auth";
import {authOptions} from "@/utils/authOptions";
import {redirect, useRouter} from "next/navigation";
import {headers} from "next/headers";
config.autoAddCss = false;

export const metadata: Metadata = {
    metadataBase: new URL("https://blueprintfactory.blog"),

  title: {
      default: "BlueprintFactory",
      template: `%s | BlueprintFactory`
  },
  description: 'Generated by create next app',
    // verification: {
    //     google: "google-site-verification=XXX"
    // },
    category: 'business'
}

export default async function RootLayout({ children }: { children: React.ReactNode }) {
    const headersList = headers();
    const url = headersList.get('x-url') || "";
    const data = await getServerSession(authOptions);

    if (url.includes("admin") && (data == null || data.user.role !== "ADMIN")) {
        redirect("/home")
    }

    if (url.includes("user") && (data == null)) {
        redirect("/home")
    }

    if (url == "http://localhost:3000/") {
        redirect("http://localhost:3000/home")
    }

    return (
        <html lang="en">
        <body>
        <AuthProvider>
            <Header/>
            <div>{url}</div>
            {children}
            <Footer/>
        </AuthProvider>
        </body>
        </html>
    )
}
